–û—Ç–ª–∏—á–Ω–æ, —è –±—É–¥—É –≤–∞—à–∏–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º –Ω–∞ Go –∏ –æ–±—ä—è—Å–Ω—é –º–∞—Ç–µ—Ä–∏–∞–ª –ª–µ–∫—Ü–∏–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ —à–∞–≥ –∑–∞ —à–∞–≥–æ–º, –ø–æ–∫–∞–∑—ã–≤–∞—è –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞.

## **–ß–∞—Å—Ç—å 1: –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä WaitGroup –±–µ–∑ –∫–∞–Ω–∞–ª–æ–≤**

```go
package main

import (
    "fmt"
    "sync"
    "time"
)

// –§—É–Ω–∫—Ü–∏—è worker - —ç—Ç–æ –≥–æ—Ä—É—Ç–∏–Ω–∞, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ä–∞–±–æ—Ç—É
func worker(id int, wg *sync.WaitGroup) {
    // defer –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ wg.Done() –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–æ –ø—Ä–∏ –ª—é–±–æ–º –≤—ã—Ö–æ–¥–µ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
    defer wg.Done()

    fmt.Printf("Worker %d starting\n", id)

    // –ò–º–∏—Ç–∏—Ä—É–µ–º —Ä–∞–±–æ—Ç—É (1 —Å–µ–∫—É–Ω–¥–∞)
    time.Sleep(time.Second)

    fmt.Printf("Worker %d done\n", id)
}

func main() {
    // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä WaitGroup
    var wg sync.WaitGroup

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤
    numWorkers := 3

    // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Ä—É—Ç–∏–Ω, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –æ–∂–∏–¥–∞—Ç—å
    wg.Add(numWorkers)

    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ –≤ –≥–æ—Ä—É—Ç–∏–Ω–∞—Ö
    for i := 0; i < numWorkers; i++ {
        go worker(i, &wg)  // –ü–µ—Ä–µ–¥–∞–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ WaitGroup
    }

    // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –≥–æ—Ä—É—Ç–∏–Ω
    wg.Wait()

    fmt.Println("All workers finished")
}
```

**–í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏ (–ø—Ä–∏–º–µ—Ä, –ø–æ—Ä—è–¥–æ–∫ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è):**

```
Worker 0 starting
Worker 2 starting
Worker 1 starting
Worker 0 done
Worker 2 done
Worker 1 done
All workers finished
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**

1. `sync.WaitGroup` - —ç—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥—Ä—É–ø–ø—ã –≥–æ—Ä—É—Ç–∏–Ω
2. `wg.Add(3)` - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –≤ 3 (–∂–¥–µ–º 3 –≥–æ—Ä—É—Ç–∏–Ω—ã)
3. –ö–∞–∂–¥–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `wg.Done()` –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ (—á–µ—Ä–µ–∑ `defer`)
4. `wg.Wait()` –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –ø–æ–∫–∞ —Å—á–µ—Ç—á–∏–∫ –Ω–µ —Å—Ç–∞–Ω–µ—Ç 0
5. –ü–æ—Ä—è–¥–æ–∫ –≤—ã–≤–æ–¥–∞ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è, —Ç–∞–∫ –∫–∞–∫ –≥–æ—Ä—É—Ç–∏–Ω—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

## **–ß–∞—Å—Ç—å 2: –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ WaitGroup**

```go
package main

import (
    "fmt"
    "sync"
)

func main() {
    var wg sync.WaitGroup

    numWorkers := 3

    // –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –î–æ–±–∞–≤–ª—è–µ–º –≤–Ω—É—Ç—Ä–∏ –≥–æ—Ä—É—Ç–∏–Ω—ã
    for i := 0; i < numWorkers; i++ {
        go func(id int) {
            wg.Add(1)  // ‚Üê –û–®–ò–ë–ö–ê: Add() –≤–Ω—É—Ç—Ä–∏ –≥–æ—Ä—É—Ç–∏–Ω—ã!
            defer wg.Done()

            fmt.Printf("Worker %d working\n", id)
        }(i)
    }

    wg.Wait()
    fmt.Println("All workers finished")
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ–≥—Ä–∞–º–º–∞ –º–æ–∂–µ—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —Ä–∞–Ω—å—à–µ, —á–µ–º –≥–æ—Ä—É—Ç–∏–Ω—ã —É—Å–ø–µ—é—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è, –ø–æ—Ç–æ–º—É —á—Ç–æ `wg.Add()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –≥–æ—Ä—É—Ç–∏–Ω—ã, –∞ –≥–ª–∞–≤–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –º–æ–∂–µ—Ç –¥–æ—Å—Ç–∏—á—å `wg.Wait()` –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ —Å—á–µ—Ç—á–∏–∫ –±—É–¥–µ—Ç —É–≤–µ–ª–∏—á–µ–Ω.

## **–ß–∞—Å—Ç—å 3: WaitGroup —Å –∫–∞–Ω–∞–ª–∞–º–∏**

```go
package main

import (
    "fmt"
    "sync"
    "time"
)

func worker(id int, results chan<- int, wg *sync.WaitGroup) {
    defer wg.Done()

    fmt.Printf("Worker %d starting\n", id)
    time.Sleep(time.Second)

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫–∞–Ω–∞–ª
    results <- id * 2

    fmt.Printf("Worker %d done\n", id)
}

func main() {
    var wg sync.WaitGroup
    numWorkers := 3

    // –°–æ–∑–¥–∞–µ–º –±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    results := make(chan int, numWorkers)

    // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Ä—É—Ç–∏–Ω
    wg.Add(numWorkers)

    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤
    for i := 0; i < numWorkers; i++ {
        go worker(i, results, &wg)
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –≥–æ—Ä—É—Ç–∏–Ω—É, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–∫—Ä–æ–µ—Ç –∫–∞–Ω–∞–ª –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤
    go func() {
        wg.Wait()          // –ñ–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –≥–æ—Ä—É—Ç–∏–Ω
        close(results)     // –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –∫–∞–Ω–∞–ª
    }()

    // –ß–∏—Ç–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ –∫–∞–Ω–∞–ª–∞
    fmt.Println("Collecting results:")
    for result := range results {
        fmt.Println("Result:", result)
    }

    fmt.Println("All workers finished")
}
```

**–í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏ (–ø—Ä–∏–º–µ—Ä):**

```
Worker 0 starting
Worker 2 starting
Worker 1 starting
Collecting results:
Worker 2 done
Result: 4
Worker 0 done
Result: 0
Worker 1 done
Result: 2
All workers finished
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**

1. –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–Ω–∞–ª `results` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ—Ç –≥–æ—Ä—É—Ç–∏–Ω
2. –û—Ç–¥–µ–ª—å–Ω–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ –∂–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ –∏ –∑–∞—Ç–µ–º –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –∫–∞–Ω–∞–ª
3. –ì–ª–∞–≤–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ —á–∏—Ç–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –∫–∞–Ω–∞–ª–∞

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å. –°–µ–π—á–∞—Å —Ç—ã –ø–æ–¥–æ—à—ë–ª –∫ **—Å–∞–º–æ–π —Å—É—Ç–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏ Go** ‚Äî –∏ –∏–º–µ–Ω–Ω–æ —Ç—É—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ ‚Äú–ª–æ–º–∞–µ—Ç –º–æ–∑–≥‚Äù.
–†–∞–∑–±–µ—Ä—ë–º –≤—Å—ë –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ—àÃÅ–∞–≥–æ–≤–æ, —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º **–∫–∞–∫ —Ä–µ–∞–ª—å–Ω–æ –¥—É–º–∞–µ—Ç runtime Go.**

---

# –ß—Ç–æ –≤–æ–æ–±—â–µ —Ç–∞–∫–æ–µ `WaitGroup`

`sync.WaitGroup` ‚Äî —ç—Ç–æ **—Å—á—ë—Ç—á–∏–∫ –∂–∏–≤—ã—Ö –≥–æ—Ä—É—Ç–∏–Ω**.

–û–Ω —Ö—Ä–∞–Ω–∏—Ç –æ–¥–Ω–æ —á–∏—Å–ª–æ:

> üî¢ **‚Äú–°–∫–æ–ª—å–∫–æ –≥–æ—Ä—É—Ç–∏–Ω –µ—â—ë –Ω–µ –∑–∞–∫–æ–Ω—á–∏–ª–∏ —Ä–∞–±–æ—Ç—É?‚Äù**

---

## –ö–∞–∫ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ (–ª–æ–≥–∏–∫–∞):

| –û–ø–µ—Ä–∞—Ü–∏—è    | –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç                                   |
| ----------- | ------------------------------------------------ |
| `wg.Add(3)` | –£—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ —Å—á—ë—Ç—á–∏–∫ = 3                           |
| `wg.Done()` | –£–º–µ–Ω—å—à–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫ –Ω–∞ 1                           |
| `wg.Wait()` | **–ë–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â—É—é –≥–æ—Ä—É—Ç–∏–Ω—É, –ø–æ–∫–∞ —Å—á—ë—Ç—á–∏–∫ ‚â† 0** |

–¢–æ –µ—Å—Ç—å:

> `wg.Wait()` =
> ‚ùó _‚Äú–°–¢–û–ô. –ù–µ –ø—Ä–æ–¥–æ–ª–∂–∞–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –ø–æ–∫–∞ –≤—Å–µ `wg.Done()` –Ω–µ –±—É–¥—É—Ç –≤—ã–∑–≤–∞–Ω—ã.‚Äù_

---

# –ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø

```
Add(N)  ‚Üí –∑–∞–ø—É—Å–∫–∞–µ–º N –≥–æ—Ä—É—Ç–∏–Ω ‚Üí –∫–∞–∂–¥–∞—è Done() ‚Üí Wait() —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
```

–ë–µ–∑ —ç—Ç–æ–≥–æ **main –º–æ–∂–µ—Ç –∑–∞–∫–æ–Ω—á–∏—Ç—å—Å—è —Ä–∞–Ω—å—à–µ —á–µ–º –≥–æ—Ä—É—Ç–∏–Ω—ã –≤–æ–æ–±—â–µ —á—Ç–æ-—Ç–æ —Å–¥–µ–ª–∞—é—Ç.**

---

# –†–∞–∑–±–æ—Ä –ø—Ä–∏–º–µ—Ä–æ–≤

---

# üü¢ –ü—Ä–∏–º–µ—Ä 1 ‚Äî –ü–†–ê–í–ò–õ–¨–ù–´–ô

```go
go func() {
    wg.Wait()
    close(results)
}()
```

### –ß—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. `wg.Add(3)` ‚Üí —Å—á—ë—Ç—á–∏–∫ = 3
2. –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è 3 worker‚Äô–∞
3. main –∑–∞—Ö–æ–¥–∏—Ç –≤:

```go
for result := range results
```

üëâ `range` **–∂–¥—ë—Ç –ø–æ–∫–∞ –∫–∞–Ω–∞–ª –Ω–µ –±—É–¥–µ—Ç –∑–∞–∫—Ä—ã—Ç**

4. –ö–∞–∂–¥—ã–π worker:

   - —Å–ø–∏—Ç 1 —Å–µ–∫
   - –∫–ª–∞–¥—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫–∞–Ω–∞–ª
   - –≤—ã–∑—ã–≤–∞–µ—Ç `wg.Done()` ‚Üí —É–º–µ–Ω—å—à–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫

5. –ö–æ–≥–¥–∞ **–ø–æ—Å–ª–µ–¥–Ω–∏–π Done()** —Å–¥–µ–ª–∞–ª —Å—á—ë—Ç—á–∏–∫ = 0
   ‚Üí `wg.Wait()` —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
   ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `close(results)`

6. `range results` –ø–æ–Ω–∏–º–∞–µ—Ç:

> –∫–∞–Ω–∞–ª –∑–∞–∫—Ä—ã—Ç –∏ –ø—É—Å—Ç ‚Üí –≤—ã—Ö–æ–¥ –∏–∑ —Ü–∏–∫–ª–∞

7. main –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è.

### –ò—Ç–æ–≥:

- –Ω–∏–∫—Ç–æ –Ω–∏–∫–æ–≥–æ –Ω–µ –±—Ä–æ—Å–∞–µ—Ç
- –Ω–µ—Ç –¥–µ–¥–ª–æ–∫–æ–≤
- –≤—Å—ë —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
  ‚úî **–∏–¥–µ–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ producer ‚Üí close ‚Üí consumer**

---

# üü° –ü—Ä–∏–º–µ—Ä 2 ‚Äî –ë–ï–ó `wg.Wait()`

```go
go func() {
    close(results)
}()
```

–¢—É—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. `results` **–∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É**
2. `range results` —Å—Ä–∞–∑—É –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è (–∫–∞–Ω–∞–ª –ø—É—Å—Ç)
3. main –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è

‚õî –†–∞–±–æ—á–∏–µ –≥–æ—Ä—É—Ç–∏–Ω—ã:

- –µ—â—ë –Ω–µ —É—Å–ø–µ–ª–∏ –ø—Ä–æ—Å–Ω—É—Ç—å—Å—è
- –Ω–æ main —É–∂–µ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è ‚Üí –ø—Ä–æ–≥—Ä–∞–º–º–∞ —É–±–∏–ª–∞ –∏—Ö

–ü–æ—ç—Ç–æ–º—É —Ç—ã –≤–∏–¥–∏—à—å:

```
Worker starting
Collecting results:
All workers finished
```

üëâ –ü—Ä–æ–≥—Ä–∞–º–º–∞ **–∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å —Ä–∞–Ω—å—à–µ —á–µ–º –æ–Ω–∏ –Ω–∞—á–∞–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å.**

---

# üî¥ –ü—Ä–∏–º–µ—Ä 3 ‚Äî –ù–ï–¢ `close(results)` –ò –ù–ï–¢ `wg.Wait()`

–°–∞–º—ã–π –≤–∞–∂–Ω—ã–π –ø—Ä–∏–º–µ—Ä.

```go
for result := range results {
    fmt.Println("Result:", result)
}
```

`range` –ø–æ –∫–∞–Ω–∞–ª—É **–ù–ò–ö–û–ì–î–ê –Ω–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è, –ø–æ–∫–∞ –∫–∞–Ω–∞–ª –Ω–µ –∑–∞–∫—Ä—ã—Ç.**

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. Workers –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ 3 –∑–Ω–∞—á–µ–Ω–∏—è
2. main –∏—Ö –ø—Ä–æ—á–∏—Ç–∞–ª
3. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∫–∞–Ω–∞–ª –ø—É—Å—Ç, –Ω–æ –ù–ï –∑–∞–∫—Ä—ã—Ç

üëâ `range` –¥—É–º–∞–µ—Ç:

> "–í–æ–∑–º–æ–∂–Ω–æ –µ—â—ë –∫—Ç–æ-—Ç–æ —á—Ç–æ-—Ç–æ –ø—Ä–∏—à–ª—ë—Ç ‚Äî –ø–æ–¥–æ–∂–¥—É..."

–í—Å–µ –≥–æ—Ä—É—Ç–∏–Ω—ã —É–∂–µ —Å–ø—è—Ç ‚Üí –Ω–∏–∫—Ç–æ –±–æ–ª—å—à–µ –ø–∏—Å–∞—Ç—å –Ω–µ –±—É–¥–µ—Ç
main –∂–¥—ë—Ç –Ω–∞–≤—Å–µ–≥–¥–∞ ‚Üí **DEADLOCK**

–û—Ç—Å—é–¥–∞:

```
fatal error: all goroutines are asleep - deadlock!
```

---

# –ü–æ—á–µ–º—É WaitGroup –∑–¥–µ—Å—å –≤–æ–æ–±—â–µ –Ω—É–∂–µ–Ω?

`close(results)` **–î–û–õ–ñ–ï–ù –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—Å–µ worker‚Äô—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å.**

–ê —É–∑–Ω–∞—Ç—å —ç—Ç–æ –º–æ–∂–Ω–æ **—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ WaitGroup.**

---

# –ó–∞–ø–æ–º–Ω–∏ –∑–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ Go:

| –ö—Ç–æ –ø–∏—à–µ—Ç –≤ –∫–∞–Ω–∞–ª | –ö—Ç–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç                               |
| ----------------- | ------------------------------------------- |
| Producers         | –¢–û–¢, –ö–¢–û –ó–ù–ê–ï–¢, –ß–¢–û –í–°–ï producers –ó–ê–ö–û–ù–ß–ò–õ–ò |

WaitGroup ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± —É–∑–Ω–∞—Ç—å **–∫–æ–≥–¥–∞ –í–°–ï producers –∑–∞–∫–æ–Ω—á–∏–ª–∏ —Ä–∞–±–æ—Ç—É.**

---

# –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞

```
workers  ‚Üí  channel  ‚Üí  main
     \____ WaitGroup ____/
             ‚Üì
          close(channel)
```

---

## **–ß–∞—Å—Ç—å 4: WaitGroup —Å –∑–∞–¥–∞—á–∞–º–∏ (–∞–Ω–∞–ª–æ–≥ Worker Pool)**

```go
package main

import (
    "fmt"
    "sync"
    "time"
)

func worker(id int, tasks <-chan int, results chan<- int, wg *sync.WaitGroup) {
    defer wg.Done()

    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–¥–∞—á–∏ –∏–∑ –∫–∞–Ω–∞–ª–∞
    for task := range tasks {
        fmt.Printf("Worker %d processing task %d\n", id, task)
        time.Sleep(time.Second)
        results <- task * 2
    }
}

func main() {
    var wg sync.WaitGroup

    numWorkers := 3
    numJobs := 5

    // –°–æ–∑–¥–∞–µ–º –∫–∞–Ω–∞–ª—ã
    tasks := make(chan int, numJobs)
    results := make(chan int, numJobs)

    // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ (–Ω–µ –∑–∞–¥–∞—á!)
    wg.Add(numWorkers)

    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤
    for i := 0; i < numWorkers; i++ {
        go worker(i+1, tasks, results, &wg)  // ID –æ—Ç 1 –¥–æ 3
    }

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á–∏
    for j := 0; j < numJobs; j++ {
        tasks <- j + 1  // –ó–∞–¥–∞—á–∏ –æ—Ç 1 –¥–æ 5
    }
    close(tasks)

    // –ì–æ—Ä—É—Ç–∏–Ω–∞ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è results –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤
    go func() {
        wg.Wait()
        close(results)
    }()

    // –°–æ–±–∏—Ä–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    fmt.Println("Collecting results:")
    for result := range results {
        fmt.Println("Result:", result)
    }

    fmt.Println("All workers finished")
}
```

**–í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏ (–ø—Ä–∏–º–µ—Ä):**

```
Worker 1 processing task 1
Worker 2 processing task 2
Worker 3 processing task 3
Collecting results:
Worker 1 processing task 4
Worker 2 processing task 5
Result: 2
Result: 4
Result: 6
Result: 8
Result: 10
All workers finished
```

**–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç:** `wg.Add(numWorkers)` –¥–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ **—Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤**, –∞ –Ω–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ **–∑–∞–¥–∞—á**!

## **–ß–∞—Å—Ç—å 5: –ü—Ä–∏–º–µ—Ä —Å —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π Worker (—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥–∫–∞)**

```go
package main

import (
    "fmt"
    "sync"
    "time"
)

// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Worker –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ –Ω–∞ —Å—Ç—Ä–æ–π–∫–µ
type Worker struct {
    ID   int
    Task string
}

// –ú–µ—Ç–æ–¥ PerformTask –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ Worker
func (w *Worker) PerformTask(wg *sync.WaitGroup) {
    defer wg.Done()

    fmt.Printf("Worker %d started %s\n", w.ID, w.Task)
    time.Sleep(time.Second)
    fmt.Printf("Worker %d finished %s\n", w.ID, w.Task)
}

func main() {
    var wg sync.WaitGroup

    // –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    tasks := []string{"digging", "laying bricks", "painting"}

    // –°–æ–∑–¥–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏
    for i, task := range tasks {
        worker := Worker{
            ID:   i + 1,  // ID –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 1
            Task: task,
        }

        wg.Add(1)  // –î–æ–±–∞–≤–ª—è–µ–º 1 –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –∫–∞–∂–¥–æ–π –≥–æ—Ä—É—Ç–∏–Ω—ã
        go worker.PerformTask(&wg)
    }

    // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤
    wg.Wait()

    fmt.Println("Construction finished")
}
```

**–í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏ (–ø—Ä–∏–º–µ—Ä):**

```
Worker 1 started digging
Worker 2 started laying bricks
Worker 3 started painting
Worker 2 finished laying bricks
Worker 1 finished digging
Worker 3 finished painting
Construction finished
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**

1. –ö–∞–∂–¥—ã–π —Ä–∞–±–æ—Ç–Ω–∏–∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π `Worker`
2. –ú–µ—Ç–æ–¥ `PerformTask` —Å–≤—è–∑–∞–Ω —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π (–ø–æ–ª—É—á–∞—Ç–µ–ª—å `*Worker`)
3. `wg.Add(1)` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–π –≥–æ—Ä—É—Ç–∏–Ω—ã –ø–µ—Ä–µ–¥ –µ–µ –∑–∞–ø—É—Å–∫–æ–º
4. –í—Å–µ –≥–æ—Ä—É—Ç–∏–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

## **–ß–∞—Å—Ç—å 6: –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –æ—à–∏–±–∫–∏ –ø—Ä–∏ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ —Å—á–µ—Ç—á–∏–∫–æ–≤**

```go
package main

import (
    "fmt"
    "sync"
    "time"
)

func worker(id int, wg *sync.WaitGroup) {
    defer wg.Done()
    fmt.Printf("Worker %d working\n", id)
    time.Sleep(time.Second)
}

func main() {
    var wg sync.WaitGroup

    numWorkers := 3

    // –û–®–ò–ë–ö–ê: –î–æ–±–∞–≤–ª—è–µ–º 2 –≤–º–µ—Å—Ç–æ 3
    wg.Add(2)  // ‚Üê –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 3!

    for i := 0; i < numWorkers; i++ {
        go worker(i, &wg)
    }

    fmt.Println("Waiting for workers...")
    wg.Wait()  // –ë—É–¥–µ—Ç –∂–¥–∞—Ç—å —Ç–æ–ª—å–∫–æ 2 Done(), –∞ –≤—ã–∑–æ–≤–µ—Ç—Å—è 3

    // –≠—Ç–∞ —Å—Ç—Ä–æ–∫–∞ –º–æ–∂–µ—Ç –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –∏–∑-–∑–∞ –¥–µ–¥–ª–æ–∫–∞
    fmt.Println("All workers finished")

    // –ü—Ä–æ–≥—Ä–∞–º–º–∞ –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–Ω—É—Ç—å, –ø–æ—Ç–æ–º—É —á—Ç–æ wg.Wait() –∂–¥–µ—Ç 2 Done(),
    // –Ω–æ –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–æ 3 Done(). –≠—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø–∞–Ω–∏–∫—É:
    // "panic: sync: negative WaitGroup counter"
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ `Add()` –∏ `Done()` –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç, –ø—Ä–æ–≥—Ä–∞–º–º–∞ –º–æ–∂–µ—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —Å –æ—à–∏–±–∫–æ–π –∏–ª–∏ –∑–∞–≤–∏—Å–Ω—É—Ç—å.

## **–ß–∞—Å—Ç—å 7: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ —Å WaitGroup**

```go
package main

import (
    "fmt"
    "sync"
    "time"
)

func main() {
    var wg sync.WaitGroup

    // –ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–û–î–•–û–î:
    // 1. –í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–π—Ç–µ Add() –≤–Ω–µ –≥–æ—Ä—É—Ç–∏–Ω
    // 2. –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ defer wg.Done()
    // 3. –ü–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ WaitGroup –ø–æ —É–∫–∞–∑–∞—Ç–µ–ª—é

    tasks := []string{"Task A", "Task B", "Task C", "Task D"}

    // –°–ø–æ—Å–æ–± 1: –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ —Å—Ä–∞–∑—É
    wg.Add(len(tasks))

    for i, task := range tasks {
        go func(id int, t string) {
            defer wg.Done()  // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤—ã–∑–æ–≤–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

            fmt.Printf("Worker %d: Starting %s\n", id, t)
            time.Sleep(time.Duration(id+1) * time.Second)
            fmt.Printf("Worker %d: Finished %s\n", id, t)
        }(i+1, task)
    }

    // –°–ø–æ—Å–æ–± 2: –î–æ–±–∞–≤–ª—è—Ç—å –ø–æ –æ–¥–Ω–æ–º—É (—Ç–æ–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ)
    /*
    for i, task := range tasks {
        wg.Add(1)  // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –∫–∞–∂–¥–æ–π –≥–æ—Ä—É—Ç–∏–Ω—ã

        go func(id int, t string) {
            defer wg.Done()
            // ... —Ä–∞–±–æ—Ç–∞ ...
        }(i+1, task)
    }
    */

    wg.Wait()
    fmt.Println("All tasks completed successfully")
}
```

**–í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏ (–ø—Ä–∏–º–µ—Ä):**

```
Worker 1: Starting Task A
Worker 2: Starting Task B
Worker 3: Starting Task C
Worker 4: Starting Task D
Worker 1: Finished Task A
Worker 2: Finished Task B
Worker 3: Finished Task C
Worker 4: Finished Task D
All tasks completed successfully
```

## **–ò—Ç–æ–≥ –ª–µ–∫—Ü–∏–∏:**

1. **WaitGroup** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥—Ä—É–ø–ø—ã –≥–æ—Ä—É—Ç–∏–Ω
2. **–¢—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–∞:**

   - `Add(delta int)` - —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫
   - `Done()` - —É–º–µ–Ω—å—à–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫ –Ω–∞ 1
   - `Wait()` - –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –ø–æ–∫–∞ —Å—á–µ—Ç—á–∏–∫ –Ω–µ —Å—Ç–∞–Ω–µ—Ç 0

3. **–ü—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

   - –í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–π—Ç–µ `Add()` **–≤–Ω–µ** –≥–æ—Ä—É—Ç–∏–Ω
   - –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `defer wg.Done()` –≤–Ω—É—Ç—Ä–∏ –≥–æ—Ä—É—Ç–∏–Ω—ã
   - –ü–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ WaitGroup **–ø–æ —É–∫–∞–∑–∞—Ç–µ–ª—é** (`&wg`)

4. **–¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**

   - –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Worker Pool
   - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á

5. **–ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏:**
   - –í—ã–∑–æ–≤ `Add()` –≤–Ω—É—Ç—Ä–∏ –≥–æ—Ä—É—Ç–∏–Ω—ã
   - –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º `Add()` –∏ `Done()`
   - –ü–µ—Ä–µ–¥–∞—á–∞ WaitGroup –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é (–≤–º–µ—Å—Ç–æ —É–∫–∞–∑–∞—Ç–µ–ª—è)

**–ö–ª—é—á–µ–≤–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** WaitGroup –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≥–æ—Ä—É—Ç–∏–Ω –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.
