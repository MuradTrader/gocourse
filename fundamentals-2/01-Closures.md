–ö–æ–Ω–µ—á–Ω–æ! –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º **–∑–∞–º—ã–∫–∞–Ω–∏—è (closures)** –≤ Go **—Å –Ω—É–ª—è**, —à–∞–≥ –∑–∞ —à–∞–≥–æ–º, –∫–∞–∫ –±—É–¥—Ç–æ —Ç—ã —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—à—å –∏–∑—É—á–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ. –ú—ã –±—É–¥–µ–º –¥–≤–∏–≥–∞—Ç—å—Å—è –º–µ–¥–ª–µ–Ω–Ω–æ, —Å –ø—Ä–æ—Å—Ç—ã–º–∏ –∞–Ω–∞–ª–æ–≥–∏—è–º–∏, –∏ –≥–ª–∞–≤–Ω–æ–µ ‚Äî **–æ–±—ä—è—Å–Ω–∏–º, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç ¬´–ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º¬ª**, —Ç–æ –µ—Å—Ç—å –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ Go.

---

# üå± –ß—Ç–æ —Ç–∞–∫–æ–µ –∑–∞–º—ã–∫–∞–Ω–∏–µ? –ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏

–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —É —Ç–µ–±—è –µ—Å—Ç—å **–º–∞–ª–µ–Ω—å–∫–∏–π —Ä–æ–±–æ—Ç**, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ–¥–Ω—É –∑–∞–¥–∞—á—É: **–ø—Ä–∏–±–∞–≤–ª—è—Ç—å 1 –∫ —á–∏—Å–ª—É**. –ù–æ —É —ç—Ç–æ–≥–æ —Ä–æ–±–æ—Ç–∞ **–Ω–µ—Ç –ø–∞–º—è—Ç–∏** ‚Äî –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ —Ç—ã –µ–≥–æ –≤—ã–∑—ã–≤–∞–µ—à—å, –æ–Ω –∑–∞–±—ã–≤–∞–µ—Ç, —Å –∫–∞–∫–æ–≥–æ —á–∏—Å–ª–∞ –Ω–∞—á–∞–ª.

–¢–µ–ø–µ—Ä—å –ø—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —Ç—ã –¥–∞—ë—à—å —ç—Ç–æ–º—É —Ä–æ–±–æ—Ç—É **–±–ª–æ–∫–Ω–æ—Ç**, –≤ –∫–æ—Ç–æ—Ä—ã–π –æ–Ω –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —á–∏—Å–ª–æ. –ö–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ —Ç—ã –µ–≥–æ –≤—ã–∑—ã–≤–∞–µ—à—å, –æ–Ω:

1. –°–º–æ—Ç—Ä–∏—Ç –≤ –±–ª–æ–∫–Ω–æ—Ç ‚Üí –≤–∏–¥–∏—Ç —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `3`);
2. –ü—Ä–∏–±–∞–≤–ª—è–µ—Ç 1 ‚Üí –ø–æ–ª—É—á–∞–µ—Ç `4`;
3. –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç `4` –æ–±—Ä–∞—Ç–Ω–æ –≤ –±–ª–æ–∫–Ω–æ—Ç;
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–±–µ `4`.

**–≠—Ç–æ—Ç —Ä–æ–±–æ—Ç + –µ–≥–æ –±–ª–æ–∫–Ω–æ—Ç = –∑–∞–º—ã–∫–∞–Ω–∏–µ.**

> üí° **–ó–∞–º—ã–∫–∞–Ω–∏–µ = —Ñ—É–Ω–∫—Ü–∏—è + –µ—ë –ª–∏—á–Ω—ã–π –±–ª–æ–∫–Ω–æ—Ç (—Å–æ—Å—Ç–æ—è–Ω–∏–µ), –∫–æ—Ç–æ—Ä—ã–π –æ–Ω–∞ ¬´–∑–∞—Ö–≤–∞—Ç–∏–ª–∞¬ª –∏–∑–≤–Ω–µ.**

---

# üß± –ë–∞–∑–æ–≤—ã–µ –ø–æ–Ω—è—Ç–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å

## 1. –§—É–Ω–∫—Ü–∏–∏ –≤ Go ‚Äî —ç—Ç–æ ¬´–≥—Ä–∞–∂–¥–∞–Ω–µ –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞¬ª

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ **—Ñ—É–Ω–∫—Ü–∏—é –º–æ–∂–Ω–æ:**

- –ø—Ä–∏—Å–≤–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π: `myFunc := someFunction`
- –ø–µ—Ä–µ–¥–∞—Ç—å –≤ –¥—Ä—É–≥—É—é —Ñ—É–Ω–∫—Ü–∏—é –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç
- –≤–µ—Ä–Ω—É—Ç—å –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–∞–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü—Ä–∏–º–µ—Ä:

```go
func sayHello() {
    fmt.Println("–ü—Ä–∏–≤–µ—Ç!")
}

func main() {
    f := sayHello      // –ø—Ä–∏—Å–≤–æ–∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏—é –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
    f()                // –≤—ã–∑–≤–∞–ª–∏ –µ—ë ‚Üí "–ü—Ä–∏–≤–µ—Ç!"
}
```

## 2. –ê–Ω–æ–Ω–∏–º–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

–≠—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ **–±–µ–∑ –∏–º–µ–Ω–∏**. –ò—Ö —á–∞—Å—Ç–æ —Å–æ–∑–¥–∞—é—Ç ¬´–Ω–∞ –ª–µ—Ç—É¬ª:

```go
func main() {
    // –∞–Ω–æ–Ω–∏–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
    greet := func() {
        fmt.Println("–ü—Ä–∏–≤–µ—Ç –∏–∑ –∞–Ω–æ–Ω–∏–º–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏!")
    }
    greet() // –≤—ã–∑–æ–≤
}
```

–¢–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω—ã, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é **–≤–Ω—É—Ç—Ä–∏ –¥—Ä—É–≥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏**.

---

# üß™ –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π —Å—á—ë—Ç—á–∏–∫ (`adder`)

–î–∞–≤–∞–π –ø–æ—Å—Ç—Ä–æ–∏–º –Ω–∞—à ¬´—Ä–æ–±–æ—Ç-—Å—á—ë—Ç—á–∏–∫¬ª.

### –ö–æ–¥

```go
package main

import "fmt"

func adder() func() int {
    i := 0
    fmt.Println("–°–æ–∑–¥–∞—é —Å—á—ë—Ç—á–∏–∫. –ù–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:", i)

    return func() int {
        i++
        fmt.Println("–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ +1:", i)
        return i
    }
}

func main() {
    sequence := adder() // ‚Üê —Å–æ–∑–¥–∞—ë–º —Ä–æ–±–æ—Ç–∞ —Å –±–ª–æ–∫–Ω–æ—Ç–æ–º

    fmt.Println("–†–µ–∑—É–ª—å—Ç–∞—Ç 1:", sequence()) // 1
    fmt.Println("–†–µ–∑—É–ª—å—Ç–∞—Ç 2:", sequence()) // 2
    fmt.Println("–†–µ–∑—É–ª—å—Ç–∞—Ç 3:", sequence()) // 3
}
```

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ —à–∞–≥–∞–º?

#### –®–∞–≥ 1: `adder()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è

- –í–Ω—É—Ç—Ä–∏ `adder()` —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `i := 0`.
- –ü–µ—á–∞—Ç–∞–µ—Ç—Å—è: `–°–æ–∑–¥–∞—é —Å—á—ë—Ç—á–∏–∫. –ù–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: 0`.
- –ó–∞—Ç–µ–º **–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∞–Ω–æ–Ω–∏–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è**.

> ‚ùó –í–∞–∂–Ω–æ: **—ç—Ç–∞ –∞–Ω–æ–Ω–∏–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `i`**, –∫–æ—Ç–æ—Ä–∞—è –æ–±—ä—è–≤–ª–µ–Ω–∞ **–≤–Ω–µ –µ—ë —Ç–µ–ª–∞**.

#### –®–∞–≥ 2: `sequence := adder()`

- –†–µ–∑—É–ª—å—Ç–∞—Ç `adder()` ‚Äî —ç—Ç–æ **–Ω–µ —á–∏—Å–ª–æ**, –∞ **—Ñ—É–Ω–∫—Ü–∏—è**.
- –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è **–ø–æ–º–Ω–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `i`**, –¥–∞–∂–µ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ `adder()` –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å.
- `sequence` —Ç–µ–ø–µ—Ä—å ‚Äî —ç—Ç–æ **–∏–º—è –¥–ª—è —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏**.

#### –®–∞–≥ 3: `sequence()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤–ø–µ—Ä–≤—ã–µ

- –ê–Ω–æ–Ω–∏–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è:
  - `i++` ‚Üí `i` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `1`
  - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `1`
- –ü–µ—á–∞—Ç–∞–µ—Ç—Å—è: `–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ +1: 1`

#### –®–∞–≥ 4: `sequence()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤—Ç–æ—Ä–æ–π —Ä–∞–∑

- –¢–∞ –∂–µ —Å–∞–º–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–Ω–æ–≤–∞:
  - `i` –≤—Å—ë –µ—â—ë —Ä–∞–≤–Ω–∞ `1` (–æ–Ω–∞ **–Ω–µ —Å–±—Ä–æ—Å–∏–ª–∞—Å—å!**)
  - `i++` ‚Üí `i = 2`
  - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `2`

> üîÅ **–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏!** –≠—Ç–æ –∏ –µ—Å—Ç—å –º–∞–≥–∏—è –∑–∞–º—ã–∫–∞–Ω–∏—è.

---

# üîç –ê —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç ¬´–ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º¬ª?

–¢–µ–ø–µ—Ä—å —Å–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ: **–∫–∞–∫ –∫–æ–º–ø—å—é—Ç–µ—Ä —ç—Ç–æ –¥–µ–ª–∞–µ—Ç?**

## üß† –û–±—ã—á–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∂–∏–≤—É—Ç –≤ ¬´—Å—Ç–µ–∫–µ¬ª

–ö–æ–≥–¥–∞ —Ç—ã –≤—ã–∑—ã–≤–∞–µ—à—å —Ñ—É–Ω–∫—Ü–∏—é, Go –≤—ã–¥–µ–ª—è–µ—Ç –¥–ª—è –Ω–µ—ë –ø–∞–º—è—Ç—å –≤ **—Å—Ç–µ–∫–µ** (stack) ‚Äî —ç—Ç–æ –±—ã—Å—Ç—Ä–∞—è, –≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å.

–ü—Ä–∏–º–µ—Ä:

```go
func temp() {
    x := 42 // x –∂–∏–≤—ë—Ç –≤ —Å—Ç–µ–∫–µ
    fmt.Println(x)
} // –∫–æ–≥–¥–∞ temp() –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è, x —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è
```

**–°—Ç–µ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É LIFO** (–ø–æ—Å–ª–µ–¥–Ω–∏–º –ø—Ä–∏—à—ë–ª ‚Äî –ø–µ—Ä–≤—ã–º —É—à—ë–ª). –ö–∞–∫ —Å—Ç–æ–ø–∫–∞ —Ç–∞—Ä–µ–ª–æ–∫.

## ‚ö†Ô∏è –ù–æ `i` –≤ `adder()` ‚Äî –Ω–µ –æ–±—ã—á–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è!

–ö–æ–≥–¥–∞ Go –≤–∏–¥–∏—Ç, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `i` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–≤–Ω—É—Ç—Ä–∏ –∞–Ω–æ–Ω–∏–º–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏**, –∫–æ—Ç–æ—Ä–∞—è **–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞—Ä—É–∂—É**, –æ–Ω –ø–æ–Ω–∏–º–∞–µ—Ç:

> ¬´–û–π! –≠—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è **—É—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã —Ñ—É–Ω–∫—Ü–∏–∏**. –ï—ë –Ω–µ–ª—å–∑—è —Ö—Ä–∞–Ω–∏—Ç—å –≤ —Å—Ç–µ–∫–µ ‚Äî –æ–Ω–∞ –∏—Å—á–µ–∑–Ω–µ—Ç, –∫–æ–≥–¥–∞ —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è!¬ª

–ü–æ—ç—Ç–æ–º—É Go –¥–µ–ª–∞–µ—Ç **escape analysis** (–∞–Ω–∞–ª–∏–∑ —É–±–µ–≥–∞–Ω–∏—è) –∏ —Ä–µ—à–∞–µ—Ç:

> ¬´–≠—Ç—É –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –Ω—É–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å –≤ **–∫—É—á–µ** (heap)!¬ª

### üíæ –°—Ç–µ–∫ vs –ö—É—á–∞

| –°—Ç–µ–∫ (Stack)                         | –ö—É—á–∞ (Heap)                       |
| ------------------------------------ | --------------------------------- |
| –ë—ã—Å—Ç—Ä–∞—è –ø–∞–º—è—Ç—å                       | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ                         |
| –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç—Å—è              | –£–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–±–æ—Ä—â–∏–∫–æ–º –º—É—Å–æ—Ä–∞ (GC) |
| –ñ–∏–≤—ë—Ç —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ | –ñ–∏–≤—ë—Ç, –ø–æ–∫–∞ –Ω–∞ –Ω–µ—ë –µ—Å—Ç—å —Å—Å—ã–ª–∫–∏    |

> ‚úÖ **`i` —Ç–µ–ø–µ—Ä—å –∂–∏–≤—ë—Ç –≤ –∫—É—á–µ**, –∏ –Ω–∞ –Ω–µ—ë —É–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–º—ã–∫–∞–Ω–∏–µ.

---

## üß© –ö–∞–∫ Go —Ö—Ä–∞–Ω–∏—Ç –∑–∞–º—ã–∫–∞–Ω–∏–µ?

Go –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–º—ã–∫–∞–Ω–∏–µ –∫–∞–∫ **—Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑ –¥–≤—É—Ö —á–∞—Å—Ç–µ–π**:

1. **–£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏** (—á—Ç–æ –¥–µ–ª–∞—Ç—å)
2. **–£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –æ–∫—Ä—É–∂–µ–Ω–∏–µ** (–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—Ö–≤–∞—á–µ–Ω—ã)

–í–Ω—É—Ç—Ä–µ–Ω–Ω–µ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ):

```go
// –≠—Ç–æ —Ç–æ, —á—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –∑–∞ –∫—É–ª–∏—Å–∞–º–∏
type adderClosure struct {
    i *int  // —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ i –≤ –∫—É—á–µ
}

func (c *adderClosure) call() int {
    *c.i++
    return *c.i
}
```

–ö–æ–≥–¥–∞ —Ç—ã –≤—ã–∑—ã–≤–∞–µ—à—å `adder()`, Go:

1. —Å–æ–∑–¥–∞—ë—Ç `i` –≤ –∫—É—á–µ ‚Üí `i = 0`
2. —Å–æ–∑–¥–∞—ë—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É `adderClosure`, —Å–æ–¥–µ—Ä–∂–∞—â—É—é —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ `i`
3. –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é, —Å–≤—è–∑–∞–Ω–Ω—É—é —Å —ç—Ç–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π

–¢–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ `sequence()` ‚Äî —ç—Ç–æ –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ `call()` –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ.

> üîó **–ó–∞–º—ã–∫–∞–Ω–∏–µ = —Ñ—É–Ω–∫—Ü–∏—è + –¥–∞–Ω–Ω—ã–µ, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω–∞ —Å—Å—ã–ª–∞–µ—Ç—Å—è.**

---

# üß™ –ü—Ä–∏–º–µ—Ä 2: –í—ã—á–∏—Ç–∞—Ç–µ–ª—å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º

–¢–µ–ø–µ—Ä—å —É—Å–ª–æ–∂–Ω–∏–º: –ø—É—Å—Ç—å —Ä–æ–±–æ—Ç —É–º–µ–µ—Ç **–≤—ã—á–∏—Ç–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —á–∏—Å–ª–∞**.

```go
func main() {
    subtractor := func() func(int) int {
        countdown := 99
        return func(x int) int {
            countdown -= x
            return countdown
        }
    }() // ‚Üê —Å—Ä–∞–∑—É –≤—ã–∑—ã–≤–∞–µ–º!

    fmt.Println(subtractor(1)) // 98
    fmt.Println(subtractor(2)) // 96
    fmt.Println(subtractor(3)) // 93
}
```

### –ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

1. –°–æ–∑–¥–∞—ë—Ç—Å—è –∞–Ω–æ–Ω–∏–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: `func() func(int) int`
2. –û–Ω–∞ **—Å—Ä–∞–∑—É –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è** ‚Üí `()`
3. –í–Ω—É—Ç—Ä–∏ –Ω–µ—ë:
   - `countdown := 99` ‚Üí –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –≤ –∫—É—á–µ
   - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç `countdown`
4. –≠—Ç–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è `subtractor`

> üí° –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **IIFE** ‚Äî Immediately Invoked Function Expression (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º–æ–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ).

–ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ `subtractor(5)`:

- —á–∏—Ç–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `countdown`
- –≤—ã—á–∏—Ç–∞–µ—Ç `5`
- —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ `countdown`
- –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ

–ò —Å–Ω–æ–≤–∞: **—Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è**, –ø–æ—Ç–æ–º—É —á—Ç–æ `countdown` –∂–∏–≤—ë—Ç –≤ –∫—É—á–µ –∏ –Ω–∞ –Ω–µ—ë —Å—Å—ã–ª–∞–µ—Ç—Å—è –∑–∞–º—ã–∫–∞–Ω–∏–µ.

---

# ‚ö†Ô∏è –û–ø–∞—Å–Ω–æ—Å—Ç–∏: –Ω–∞ —á—Ç–æ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ

## 1. –í—Å–µ –∑–∞–º—ã–∫–∞–Ω–∏—è –¥–µ–ª—è—Ç –æ–¥–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é (–µ—Å–ª–∏ –Ω–µ –æ—Å—Ç–æ—Ä–æ–∂–µ–Ω)

```go
funcs := make([]func(), 3)
for i := 0; i < 3; i++ {
    funcs[i] = func() { fmt.Println(i) }
}
// –í—ã–∑–æ–≤–µ–º –≤—Å–µ:
funcs[0]() // 3
funcs[1]() // 3
funcs[2]() // 3 ‚Üê –≤—Å–µ –ø–µ—á–∞—Ç–∞—é—Ç 3!
```

**–ü–æ—á–µ–º—É?** –ü–æ—Ç–æ–º—É —á—Ç–æ –≤—Å–µ —Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—Ç **–æ–¥–Ω—É –∏ —Ç—É –∂–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `i`**, –∫–æ—Ç–æ—Ä–∞—è –≤ –∫–æ–Ω—Ü–µ —Ü–∏–∫–ª–∞ —Ä–∞–≤–Ω–∞ `3`.

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:

```go
for i := 0; i < 3; i++ {
    i := i // —Å–æ–∑–¥–∞—ë–º –ö–û–ü–ò–Æ i –≤ –Ω–æ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
    funcs[i] = func() { fmt.Println(i) }
}
```

–¢–µ–ø–µ—Ä—å –∫–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç **—Å–≤–æ—é –∫–æ–ø–∏—é** `i`.

## 2. –£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏

–ï—Å–ª–∏ –∑–∞–º—ã–∫–∞–Ω–∏–µ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –±–æ–ª—å—à–æ–π –æ–±—ä–µ–∫—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞—Ä—Ç–∏–Ω–∫—É), –∏ –∑–∞–º—ã–∫–∞–Ω–∏–µ –∂–∏–≤—ë—Ç –¥–æ–ª–≥–æ ‚Äî –æ–±—ä–µ–∫—Ç **–Ω–µ –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è**, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω.

‚úÖ **–°–æ–≤–µ—Ç**: –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–π —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ.

## 3. –ì–æ–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö (data races)

–ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥–æ—Ä—É—Ç–∏–Ω –≤—ã–∑—ã–≤–∞—é—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –∑–∞–º—ã–∫–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∏–∑–º–µ–Ω—è–µ—Ç –∑–∞—Ö–≤–∞—á–µ–Ω–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é ‚Äî –±—É–¥–µ—Ç **–≥–æ–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö**.

‚úÖ **–†–µ—à–µ–Ω–∏–µ**: –∏—Å–ø–æ–ª—å–∑—É–π `sync.Mutex` –∏–ª–∏ –∫–∞–Ω–∞–ª—ã –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

---

# üß† –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ? –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã

### 1. –°—á—ë—Ç—á–∏–∫–∏, –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã

```go
nextID := func() func() int {
    id := 0
    return func() int {
        id++
        return id
    }
}()
fmt.Println(nextID()) // 1
fmt.Println(nextID()) // 2
```

### 2. Middleware –≤ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–µ

```go
func loggingMiddleware(next http.HandlerFunc) http.HandlerFunc {
    return func(w http.ResponseWriter, r *http.Request) {
        log.Println("–ó–∞–ø—Ä–æ—Å –Ω–∞—á–∞–ª—Å—è")
        next(w, r)
        log.Println("–ó–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à—ë–Ω")
    }
}
```

–ó–¥–µ—Å—å `next` ‚Äî —ç—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, –∫–æ—Ç–æ—Ä—ã–π ¬´–∑–∞—Ö–≤–∞—á–µ–Ω¬ª middleware.

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

```go
multiplyBy := func(factor int) func(int) int {
    return func(x int) int {
        return x * factor
    }
}

double := multiplyBy(2)
triple := multiplyBy(3)
```

---

# üìå –ò—Ç–æ–≥: –∫–ª—é—á–µ–≤—ã–µ –∏–¥–µ–∏

| –ò–¥–µ—è                              | –û–±—ä—è—Å–Ω–µ–Ω–∏–µ                                                             |
| --------------------------------- | ---------------------------------------------------------------------- |
| **–ó–∞–º—ã–∫–∞–Ω–∏–µ**                     | –§—É–Ω–∫—Ü–∏—è + –∑–∞—Ö–≤–∞—á–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è                 |
| **–õ–µ–∫—Å–∏—á–µ—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏** | –§—É–Ω–∫—Ü–∏—è ¬´–ø–æ–º–Ω–∏—Ç¬ª, –≥–¥–µ –æ–Ω–∞ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞, –∞ –Ω–µ –≥–¥–µ –≤—ã–∑–≤–∞–Ω–∞               |
| **Escape analysis**               | Go —Ä–µ—à–∞–µ—Ç: —Ö—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ —Å—Ç–µ–∫–µ –∏–ª–∏ –∫—É—á–µ                         |
| **–ö—É—á–∞ (heap)**                   | –ü–∞–º—è—Ç—å, –≥–¥–µ –∂–∏–≤—É—Ç –∑–∞—Ö–≤–∞—á–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ                               |
| **–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è**         | –ü–æ—Ç–æ–º—É —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ —É–Ω–∏—á—Ç–æ–∂–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–Ω–µ—à–Ω–µ–π —Ñ—É–Ω–∫—Ü–∏–∏ |
| **–ó–∞—Ö–≤–∞—Ç –ø–æ —Å—Å—ã–ª–∫–µ**              | –í—Å–µ –∑–∞–º—ã–∫–∞–Ω–∏—è, –∑–∞—Ö–≤–∞—Ç–∏–≤—à–∏–µ –æ–¥–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –¥–µ–ª—è—Ç –µ—ë                   |

---
